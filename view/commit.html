<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <script src="./util.js"></script>
    <script src="./data/ibdCommitData.js"></script>
    <script>
        makeGrid(ibdCommitData);

        // 计算总天数
        function makeGrid(data) {
            const startDate = util.time(2017, 0, 1);
            const days = (util.time(2018, 0, 1) - startDate) / (1000 * 60 * 60 * 24);
            const weeks = Math.ceil(days / 7);
            let startDay = (startDate.getDay() - 1 + 7) % 7;
            let drawData = {};
            data.commits.forEach(function (item, index) {
                let date = item.date;
                let step = (new Date(date) - startDate) / (1000 * 60 * 60 * 24);
                let weekIndex = step / 7 << 0;
                let day = (new Date(date).getDay() - 1 + 7) % 7;
                const tag = weekIndex + '-' + day;
                if (!drawData[tag]) {
                    drawData[tag] = {
                        // 第几周
                        date,
                        commits: 1,
                        filesNum: item.filesNum,
                        lineNum: item.lineNum
                    };
                } else {
                    drawData[tag].filesNum += item.filesNum;
                    drawData[tag].lineNum += item.lineNum;
                    drawData[tag].commits++;
                }
            });
            let border = util.element('div', {
                css: {
                    height: '400px'
                }
            }, document.body);
            for (let w = 0; w < weeks; w++) {
                let col = util.element('div', {
                    css: {
                        // width: '20px',
                        height: '100%',
                        float: 'left'
                    }
                }, border);
                for (let d = 0; d < 7; d++) {
                    let tag = w + '-' + d;
                    let block = util.element('div', {
                        css: {
                            border: '2px solid white',
                            width: '10px',
                            height: '10px',
                            cursor: drawData[tag] ? 'pointer' : '',
                            background: drawData[tag] ? 'green' : 'white'
                        }
                    }, col);
                }
            }
        }
    </script>
</body>

</html>